(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{ekgB:function(t,e,n){"use strict";n.r(e),n.d(e,"GamePageModule",(function(){return C}));var i=n("ofXK"),o=n("3Pt+"),s=n("TEn/"),c=n("tyNb"),r=n("mrSG"),a=n("2Vo4"),b=n("nYR2"),l=n("HM5V"),u=n("SAsG"),d=n("fXoL"),f=n("H+bZ"),h=n("OC8m");let m=(()=>{class t{constructor(){this.endpoint="ws://2.238.108.96:3000"}initWebSocket(t,e){return this.websocket=new WebSocket(this.endpoint),this.subscribeUpdate(e.name,t.code),this.stateListener=new a.a(t),this.stateListener}subscribeUpdate(t,e){this.websocket.onopen=()=>{this.websocket.send(JSON.stringify({type:"init",nick:t,code:e})),this.websocket.onmessage=t=>{const e=JSON.parse(t.data);switch(e.type){case"init":this.uuid=e.uuid;break;case"update":this.stateListener.next(e.state);break;case"move":break;default:this.stateListener.next(void 0),console.log(e)}},this.websocket.onclose=()=>{this.stateListener.next(void 0)}}}sendMove(t){this.websocket&&this.websocket.send(JSON.stringify({type:"move",uuid:this.uuid,move:t}))}closeWebSocket(){this.websocket&&this.websocket.close()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=d.Db({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function p(t,e){if(1&t){const t=d.Nb();d.Kb(0),d.Mb(1,"ion-icon",13),d.Ub("click",(function(){return d.ec(t),d.Wb().openPlayersModal()})),d.Lb(),d.Mb(2,"ion-badge",14),d.Ub("click",(function(){return d.ec(t),d.Wb().openPlayersModal()})),d.ic(3),d.Lb(),d.Jb()}if(2&t){const t=d.Wb();d.xb(3),d.kc(" ",t.state.players.length," ")}}function y(t,e){if(1&t&&(d.Mb(0,"ion-chip",15),d.Ib(1,"ion-icon",16),d.Mb(2,"ion-label"),d.ic(3),d.Lb(),d.Lb()),2&t){const t=d.Wb();d.xb(3),d.jc(t.currentPlayer.balance)}}function v(t,e){if(1&t&&(d.Mb(0,"div",17),d.Mb(1,"div",18),d.Ib(2,"img",19),d.Lb(),d.Lb()),2&t){const t=d.Wb();d.xb(2),d.ac("src","./assets/cardSets/",t.state.cardSet,"/",t.currentPlayer.cards[0],".png",d.fc)}}function g(t,e){if(1&t){const t=d.Nb();d.Mb(0,"ion-fab-list",24),d.Mb(1,"ion-fab-button",25),d.Ub("click",(function(){d.ec(t);const e=d.Wb(2);return e.sendMove(e.currentPlayer.moves[0])})),d.ic(2),d.Lb(),d.Lb()}if(2&t){const t=d.Wb(2);d.xb(2),d.jc(t.currentPlayer.moves[0].name)}}function M(t,e){if(1&t){const t=d.Nb();d.Mb(0,"ion-fab-list",24),d.Mb(1,"ion-fab-button",25),d.Ub("click",(function(){d.ec(t);const e=d.Wb(2);return e.sendMove(e.currentPlayer.moves[1])})),d.ic(2),d.Lb(),d.Lb()}if(2&t){const t=d.Wb(2);d.xb(2),d.jc(t.currentPlayer.moves[1].name)}}function P(t,e){if(1&t){const t=d.Nb();d.Mb(0,"ion-fab-list",26),d.Mb(1,"ion-fab-button",25),d.Ub("click",(function(){d.ec(t);const e=d.Wb(2);return e.sendMove(e.currentPlayer.moves[2])})),d.ic(2),d.Lb(),d.Lb()}if(2&t){const t=d.Wb(2);d.xb(2),d.jc(t.currentPlayer.moves[2].name)}}function x(t,e){if(1&t){const t=d.Nb();d.Mb(0,"ion-fab-list",27),d.Mb(1,"ion-fab-button",25),d.Ub("click",(function(){d.ec(t);const e=d.Wb(2);return e.sendMove(e.currentPlayer.moves[3])})),d.ic(2),d.Lb(),d.Lb()}if(2&t){const t=d.Wb(2);d.xb(2),d.jc(t.currentPlayer.moves[3].name)}}function L(t,e){if(1&t){const t=d.Nb();d.Mb(0,"ion-fab-list",28),d.Mb(1,"ion-fab-button",25),d.Ub("click",(function(){d.ec(t);const e=d.Wb(2);return e.sendMove(e.currentPlayer.moves[4])})),d.ic(2),d.Lb(),d.Lb()}if(2&t){const t=d.Wb(2);d.xb(2),d.jc(t.currentPlayer.moves[4].name)}}function k(t,e){if(1&t&&(d.Kb(0),d.hc(1,g,3,1,"ion-fab-list",20),d.hc(2,M,3,1,"ion-fab-list",20),d.hc(3,P,3,1,"ion-fab-list",21),d.hc(4,x,3,1,"ion-fab-list",22),d.hc(5,L,3,1,"ion-fab-list",23),d.Jb()),2&t){const t=d.Wb();d.xb(1),d.Zb("ngIf",!t.state.status),d.xb(1),d.Zb("ngIf",t.state.status),d.xb(1),d.Zb("ngIf",t.currentPlayer.moves.length>2),d.xb(1),d.Zb("ngIf",t.currentPlayer.moves.length>3),d.xb(1),d.Zb("ngIf",t.currentPlayer.moves.length>4)}}function w(t,e){if(1&t){const t=d.Nb();d.Mb(0,"ion-fab-list",26),d.Mb(1,"ion-fab-button",25),d.Ub("click",(function(){d.ec(t);const e=d.Wb(2);return e.sendMove(e.currentPlayer.moves[0])})),d.ic(2),d.Lb(),d.Lb()}if(2&t){const t=d.Wb(2);d.xb(2),d.jc(t.currentPlayer.moves[0].name)}}function S(t,e){if(1&t){const t=d.Nb();d.Mb(0,"ion-fab-list",27),d.Mb(1,"ion-fab-button",25),d.Ub("click",(function(){d.ec(t);const e=d.Wb(2);return e.sendMove(e.currentPlayer.moves[1])})),d.ic(2),d.Lb(),d.Lb()}if(2&t){const t=d.Wb(2);d.xb(2),d.jc(t.currentPlayer.moves[1].name)}}function W(t,e){if(1&t){const t=d.Nb();d.Mb(0,"ion-fab-list",28),d.Mb(1,"ion-fab-button",25),d.Ub("click",(function(){d.ec(t);const e=d.Wb(2);return e.sendMove(e.currentPlayer.moves[2])})),d.ic(2),d.Lb(),d.Lb()}if(2&t){const t=d.Wb(2);d.xb(2),d.jc(t.currentPlayer.moves[2].name)}}function I(t,e){if(1&t&&(d.Kb(0),d.hc(1,w,3,1,"ion-fab-list",21),d.hc(2,S,3,1,"ion-fab-list",22),d.hc(3,W,3,1,"ion-fab-list",23),d.Jb()),2&t){const t=d.Wb();d.xb(1),d.Zb("ngIf",t.currentPlayer.moves.length>0),d.xb(1),d.Zb("ngIf",t.currentPlayer.moves.length>1),d.xb(1),d.Zb("ngIf",t.currentPlayer.moves.length>2)}}const N=[{path:"",component:(()=>{class t{constructor(t,e,n,i,o,s,c,r){this.route=t,this.router=e,this.api=n,this.modalController=i,this.alertController=o,this.notificationService=s,this.popoverController=c,this.updateStateService=r}ngOnInit(){this.route.queryParams.subscribe(t=>{t&&t.group&&t.player?(this.state=JSON.parse(t.group),this.stateListener=new a.a(this.state),this.currentPlayer=JSON.parse(t.player),this.currentGame=JSON.parse(t.game)):this.exitGame(),this.notificationService.enableNotifications(),this.initUpdateService()})}initUpdateService(){this.updateStateService.initWebSocket(this.state,this.currentPlayer).subscribe(t=>{t?(this.prevState=this.state,this.state=t,this.stateListener.next(this.state),this.currentPlayer=this.state.players.find(t=>t.name===this.currentPlayer.name),this.checkNotifications(),this.updateTitle()):this.exitGame()})}updateTitle(){if(this.state)if(!1===this.state.status)this.title=this.state.players.length>1?"Partita in pausa":"In attesa...";else{const t=this.state.players.find(t=>!0===t.canMove);this.title=t?this.currentPlayer.canMove?"E' il tuo turno!":"E' il turno di "+t.name:"Giro terminato"}}confirmExit(){return Object(r.a)(this,void 0,void 0,(function*(){const t=yield this.alertController.create({header:"Aspetta!",message:"Sei proprio sicuro di volere uscire?",buttons:[{text:"Annulla",role:"cancel"},{text:"Si",handler:()=>{this.exitGame()}}]});yield t.present()}))}exitGame(){this.playerModal&&this.playerModal.dismiss(),this.updateStateService.closeWebSocket(),this.api.exitGroup(this.currentPlayer.name,this.state.code).pipe(Object(b.a)(()=>this.router.navigate(["/"]))).subscribe()}isAdmin(){if(this.state)return this.state.players.find(t=>t.name===this.currentPlayer.name).isAdmin}openPlayersModal(){return Object(r.a)(this,void 0,void 0,(function*(){this.playerModal=yield this.modalController.create({component:u.a,componentProps:{state:this.stateListener,nickname:this.currentPlayer.name}}),yield this.playerModal.present()}))}checkNotifications(){const t=this.state.players,e=this.prevState.players,n=this.state.players.find(t=>!0===t.isAdmin).name,i=this.prevState.players.find(t=>!0===t.isAdmin).name;t.forEach(t=>{let n=!1;e.forEach(e=>{t.name===e.name&&(n=!0)}),n||this.notificationService.addNotification(t.name+" si \xe8 connesso/a",l.a.Login)}),e.forEach(e=>{let n=!1;t.forEach(t=>{t.name===e.name&&(n=!0)}),n||this.notificationService.addNotification(e.name+" si \xe8 disconnesso/a",l.a.Logout)}),n!==i&&this.notificationService.addNotification(n+" \xe8 il nuovo mazziere",l.a.Logout)}sendMove(t){this.updateStateService.sendMove(t.id)}}return t.\u0275fac=function(e){return new(e||t)(d.Hb(c.a),d.Hb(c.g),d.Hb(f.a),d.Hb(s.F),d.Hb(s.a),d.Hb(h.a),d.Hb(s.I),d.Hb(m))},t.\u0275cmp=d.Bb({type:t,selectors:[["app-game"]],decls:17,vars:9,consts:[[3,"translucent"],["lines","none"],["name","arrow-back-circle-outline","color","danger",3,"click"],["mode","md"],[4,"ngIf"],[3,"fullscreen"],[1,"cards-area"],[1,"other-cards-container"],["class","my-balance","outline","",4,"ngIf"],["class","cards-container",4,"ngIf"],["horizontal","center","slot","fixed",1,"action-button"],["color","warning",3,"disabled"],["name","caret-up-outline"],["name","people-outline",3,"click"],["color","success","slot","end",3,"click"],["outline","",1,"my-balance"],["name","server","color","warning"],[1,"cards-container"],[1,"card"],[3,"src"],["side","top",4,"ngIf"],["side","bottom",4,"ngIf"],["side","start",4,"ngIf"],["side","end",4,"ngIf"],["side","top"],[1,"fab",3,"click"],["side","bottom"],["side","start"],["side","end"]],template:function(t,e){1&t&&(d.Mb(0,"ion-header",0),d.Mb(1,"ion-toolbar"),d.Mb(2,"ion-item",1),d.Mb(3,"ion-icon",2),d.Ub("click",(function(){return e.confirmExit()})),d.Lb(),d.Mb(4,"ion-title",3),d.ic(5),d.Lb(),d.hc(6,p,4,1,"ng-container",4),d.Lb(),d.Lb(),d.Lb(),d.Mb(7,"ion-content",5),d.Mb(8,"div",6),d.Mb(9,"div",7),d.hc(10,y,4,1,"ion-chip",8),d.Lb(),d.hc(11,v,3,2,"div",9),d.Lb(),d.Mb(12,"ion-fab",10),d.Mb(13,"ion-fab-button",11),d.Ib(14,"ion-icon",12),d.Lb(),d.hc(15,k,6,5,"ng-container",4),d.hc(16,I,4,3,"ng-container",4),d.Lb(),d.Lb()),2&t&&(d.Zb("translucent",!0),d.xb(5),d.jc(e.title),d.xb(1),d.Zb("ngIf",e.state&&e.state.players),d.xb(1),d.Zb("fullscreen",!0),d.xb(3),d.Zb("ngIf",e.state.money),d.xb(1),d.Zb("ngIf",e.currentPlayer.cards.length>0),d.xb(2),d.Zb("disabled",!((e.currentPlayer.isAdmin||!e.currentPlayer.isAdmin&&e.currentPlayer.canMove)&&e.state.players.length>=e.currentGame.minPlayers)),d.xb(2),d.Zb("ngIf",e.currentPlayer.isAdmin),d.xb(1),d.Zb("ngIf",!e.currentPlayer.isAdmin))},directives:[s.l,s.C,s.o,s.m,s.A,i.j,s.h,s.i,s.j,s.d,s.g,s.s,s.k],styles:[".fab[_ngcontent-%COMP%]{width:15vw!important;height:15vw!important}.cards-container[_ngcontent-%COMP%]{width:100%;height:60%;text-align:center}.other-cards-container[_ngcontent-%COMP%]{height:40%}.card[_ngcontent-%COMP%], .card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%}.card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:.05px solid #d3d3d3;border-radius:5vw;box-shadow:0 5px 20px 0 #d3d3d3;filter:contrast(1.2)}.cards-area[_ngcontent-%COMP%]{height:60%}.action-button[_ngcontent-%COMP%]{bottom:25vw}.my-balance[_ngcontent-%COMP%]{position:absolute;top:16vw;right:2vw}"]}),t})()}];let O=(()=>{class t{}return t.\u0275mod=d.Fb({type:t}),t.\u0275inj=d.Eb({factory:function(e){return new(e||t)},imports:[[c.i.forChild(N)],c.i]}),t})(),C=(()=>{class t{}return t.\u0275mod=d.Fb({type:t}),t.\u0275inj=d.Eb({factory:function(e){return new(e||t)},imports:[[i.b,o.a,s.D,O]]}),t})()}}]);